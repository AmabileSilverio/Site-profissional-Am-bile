<!doctype html>
<html lang="pt-BR">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Contatos - Admin</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
    <style>
      body { padding: 40px; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
      pre { white-space: pre-wrap; word-break: break-word; }
    </style>
  </head>
  <body>
    <div class="container">
      <h1 class="mb-4">Contatos (localStorage)</h1>
      <p class="text-muted">Esta página mostra os contatos salvos no <code>localStorage</code> pelo formulário (útil para demonstrações sem backend).</p>

      <div class="mb-3">
        <button id="btn-carregar" class="btn btn-primary">Carregar contatos</button>
        <button id="btn-exportar" class="btn btn-outline-secondary ms-2">Exportar JSON</button>
        <button id="btn-limpar" class="btn btn-danger ms-2">Limpar todos</button>
      </div>

      <div id="lista" class="list-group"></div>

      <h3 class="mt-4">JSON</h3>
      <pre id="jsonArea" class="p-3 border bg-light" style="max-height: 400px; overflow:auto;"></pre>
    </div>

    <script>
      const chave = 'contatos_site_amabile';
      const btnCarregar = document.getElementById('btn-carregar');
      const btnExportar = document.getElementById('btn-exportar');
      const btnLimpar = document.getElementById('btn-limpar');
      const lista = document.getElementById('lista');
      const jsonArea = document.getElementById('jsonArea');

      function carregar() {
        const dados = JSON.parse(localStorage.getItem(chave) || '[]');
        lista.innerHTML = '';
        if (!dados.length) {
          lista.innerHTML = '<div class="alert alert-info">Nenhum contato salvo no localStorage.</div>';
          jsonArea.textContent = '[]';
          return;
        }
        dados.slice().reverse().forEach((c, idx) => {
          const item = document.createElement('div');
          item.className = 'list-group-item';
          item.innerHTML = `<div class="d-flex w-100 justify-content-between">
            <h5 class="mb-1">${escapeHtml(c.nome || '')}</h5>
            <small>${new Date(c.data).toLocaleString()}</small>
          </div>
          <p class="mb-1"><strong>Assunto:</strong> ${escapeHtml(c.assunto || '')}</p>
          <p class="mb-1"><strong>E-mail:</strong> ${escapeHtml(c.email || '')}</p>
          <p class="mb-1"><strong>Mensagem:</strong> ${escapeHtml(c.mensagem || '')}</p>
          <small class="text-muted">Origem: ${escapeHtml(c.origem || '')}</small>`;
          lista.appendChild(item);
        });
        jsonArea.textContent = JSON.stringify(dados, null, 2);
      }

      function exportar() {
        const dados = localStorage.getItem(chave) || '[]';
        const blob = new Blob([dados], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'contatos_local.json';
        a.click();
        URL.revokeObjectURL(url);
      }

      function limpar() {
        if (!confirm('Deseja realmente apagar todos os contatos salvos localmente?')) return;
        localStorage.removeItem(chave);
        carregar();
      }

      function escapeHtml(unsafe) {
        return unsafe
          .replaceAll('&', '&amp;')
          .replaceAll('<', '&lt;')
          .replaceAll('>', '&gt;')
          .replaceAll('"', '&quot;')
          .replaceAll("'", '&#039;');
      }

      btnCarregar.addEventListener('click', carregar);
      btnExportar.addEventListener('click', exportar);
      btnLimpar.addEventListener('click', limpar);

      // carregar automaticamente ao abrir
      carregar();
    </script>
  </body>
</html>